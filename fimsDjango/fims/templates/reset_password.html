{% extends 'base.html' %}
{% load static %}

{% block title %}Reset Password{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'fims/css/reset_password.css' %}">
{% endblock %}

{% block content %}
<div class="center">
    <h1>Reset Password</h1>

    {% if messages %}
        {% for message in messages %}
            {% if message.tags == 'error' %}
                <center><h4 style="color: firebrick;">{{ message }}</h4></center>
            {% else %}
                <center><h4 style="color: dodgerblue;">{{ message }}</h4></center>
            {% endif %}
        {% endfor %}
    {% endif %}

    <form method="POST">
        {% csrf_token %}

                <div class="txt_field">
                    <label>Password:</label>
                        <input type="password" name="password" id="reset-password">
                        <span></span>
                        <div id="passwordError" class="error-message" style="color: red;"></div>
                </div>

                <div class="txt_field">
                    <label>Confirm Password:</label>
                        <input type="password" name="confirm_password" id="reset-confirm-password">
                        <span></span>
                        <div id="confirmPasswordError" class="error-message" style="color: red;"></div>
                </div>

        <input type="submit" value="Reset Password">

        <div class="signup_link">
            Remember your password? <a href="{% url 'login_view' %}">Login</a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    function validatePassword() {
        const password = document.getElementById('reset-password').value;
        const errorDiv = document.getElementById('passwordError');
        // At least 1 special character and min 6 chars
        const specialChar = /[!@#$%^&*(),.?":{}|<>]/;
        if (password.length < 6) {
            errorDiv.textContent = 'Password must be at least 6 characters.';
            return false;
        } else if (!specialChar.test(password)) {
            errorDiv.textContent = 'Password must contain at least 1 special character.';
            return false;
        } else {
            errorDiv.textContent = '';
            return true;
        }
    }
    function validateConfirmPassword() {
        const password = document.getElementById('reset-password').value;
        const confirm = document.getElementById('reset-confirm-password').value;
        const errorDiv = document.getElementById('confirmPasswordError');
        if (password !== confirm) {
            errorDiv.textContent = 'Passwords do not match.';
            return false;
        } else {
            errorDiv.textContent = '';
            return true;
        }
    }
    document.getElementById('reset-password').addEventListener('input', validatePassword);
    document.getElementById('reset-confirm-password').addEventListener('input', validateConfirmPassword);
    document.querySelector('form').addEventListener('submit', function(e) {
        const valid1 = validatePassword();
        const valid2 = validateConfirmPassword();
        if (!valid1 || !valid2) {
            e.preventDefault();
        }
    });
});
</script>
<script src="{% static 'fims/js/reset_password.js' %}"></script>
{% endblock %}
