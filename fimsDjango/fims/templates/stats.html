{% extends 'base.html' %}
{% load static %}

{% block title %}Quick Stats{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'fims/css/stats.css' %}">
{% endblock %}

{% block content %}
<section id="stats-page">

  <div class="stats-left">
    <div class="chart-box">
      <h2>Gender Distribution</h2>
      <canvas id="genderPieChart"></canvas>
      {{ labels|json_script:"gender-labels" }}
      {{ data|json_script:"gender-data" }}
    </div>

    <div class="chart-box">
      <h2>Active vs Inactive</h2>
      <canvas id="activeDonutChart"></canvas>
      <script id="active-inactive-data" type="application/json">
        [
          { "label": "Active", "value": {{ active_members|default:0 }} },
          { "label": "Inactive", "value": {{ inactive_members|default:0 }} }
        ]
      </script>
    </div>
  </div>


  <div class="stats-right">
    <div class="card"><h1>Total Families Registered</h1><p>{{ total_families }}</p></div>
    <div class="card"><h1>Total Family Members</h1><p>{{ total_members }}</p></div>
    <div class="card"><h1>Married People</h1><p>{{ married_people }}</p></div>
    <div class="card"><h1>Unmarried People</h1><p>{{ unmarried_people }}</p></div>
    <div class="card"><h1>Total Active Members</h1><p>{{ active_members }}</p></div>
    <div class="card"><h1>Total Cities Registered</h1><p>{{ total_cities }}</p></div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  // Pie Chart
  const genderCtx = document.getElementById('genderPieChart').getContext('2d');
  new Chart(genderCtx, {
    type: 'pie',
    data: {
      labels: JSON.parse(document.getElementById('gender-labels').textContent),
      datasets: [{
        data: JSON.parse(document.getElementById('gender-data').textContent),
        backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56'],
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: 'bottom' } }
    }
  });

  // Donut Chart
  const activeData = JSON.parse(document.getElementById('active-inactive-data').textContent);
  const donutCtx = document.getElementById('activeDonutChart').getContext('2d');
  new Chart(donutCtx, {
    type: 'doughnut',
    data: {
      labels: activeData.map(item => item.label),
      datasets: [{
        data: activeData.map(item => item.value),
        backgroundColor: ['#4CAF50', '#F44336'],
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '70%',
      plugins: { legend: { position: 'bottom' } }
    }
  });
});
</script>
{% endblock %}
